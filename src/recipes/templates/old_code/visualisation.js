function main(e,t,a){var n=[],r=[],o=[],i=[],s=[],c=[],d=topojson.feature(t,t.objects.countries).features;a.forEach(function(e){r[e.id]=e.name,e.c1>0&&(n[e.id]=e.id),e.c1>0&&(o[e.id]=e.c1),e.c1>0&&(i[e.id]=e.recipes),e.c1>0&&(s[e.id]=e.Ing),e.c1>0&&(c[e.id]=e.Cat)});var l=d3.scale.linear().domain([0,32]).range(["red","yellow"]);for(g.selectAll("path").data(d).enter().append("svg:path").attr("d",path).attr("id",function(e){return"_"+e.id}).attr("name",function(e){return e.name}).on("mouseover",function(e){country_selector.text(r[e.id]).style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px").style("display","block").style("opacity",.8)}).on("mouseout",function(){country_selector.style("opacity",0).style("display","none")}).on("mousemove",function(){country_selector.style("left",d3.event.pageX+7+"px").style("top",d3.event.pageY-15+"px")}).on("click",function(e){if(o[e.id]>-1){var t=(d3.select(this).style("fill","#660033"),r[e.id]),a={statements:[{statement:'MATCH (a)-[n:SIMILIARITY]->(b) WHERE a.name= "'+t+'" AND b.scope = "Country" RETURN b.name AS CUISINE, 1/n.value AS SIMILARITY, b.country_ID AS IDC ORDER BY n.value DESC'}]};$.ajax({type:"POST",accept:"application/json",contentType:"application/json; charset=utf-8",url:"//recipesdatabasesimilairites.sb02.stations.graphenedb.com:24789/db/data/transaction/commit",headers:{Authorization:"Basic <cmVjaXBlc19kYXRhYmFzZV9zaW1pbGFpcml0ZXM6ZGJSRnRScXJmMWg1VFpjbHdlMGY=>"},data:JSON.stringify(a),success:function(t){var a=document.getElementById("paragraph_text");null!=a&&a.parentNode.removeChild(a);var n=document.createElement("p");n.id="paragraph_text";var o=document.getElementById("inside_map");if(o.appendChild(n),i[e.id]>1e3)var d="Cuisine selected: "+r[e.id]+"<br>Number of recipes: <br>"+i[e.id]+"<br>Number of categories: "+c[e.id]+"<br>Number of ingredients: "+s[e.id]+"<br>";else var d="Cuisine selected: "+r[e.id]+"<br>Number of recipes: "+i[e.id]+"<br>Number of categories: "+c[e.id]+"<br>Number of ingredients: "+s[e.id]+"<br>";var p=document.getElementById("paragraph_text");for(p.innerHTML=p.innerHTML+d+"________________<br>",z=0;z<31;z++){d3.select("path#_"+t.results[0].data[z].row[2]).style("fill",l(z)).style("stroke-width","1px").attr("class","selected");var u=t.results[0].data[z].row[0],m=t.results[0].data[z].row[1];m=m.toFixed(3);var g=z+1,h=g+": "+u+" - "+m,p=document.getElementById("paragraph_text");p.innerHTML=p.innerHTML+h+"<br>"}},failure:function(){console.log("failed")}})}else window.alert("NOT IN DATASET. Please choose a shaded country.")}),k=0;k<n.length;k++)d3.select("path#_"+n[k]).attr("class","in_scope")}var width=2e3,height=600,svg=d3.select("#map").append("svg").attr("width",width).attr("height",height),projection=d3.geo.mercator().center([0,35]).scale(200).rotate([0,0,0]),path=d3.geo.path().projection(projection),g=svg.append("g"),country_selector=d3.select("#map").append("div").attr("class","country_selector").attr("width",width).attr("height",height/20);queue().defer(d3.json,"world-110m.json").defer(d3.csv,"country_data.csv").await(main);var zooming=d3.behavior.zoom().on("zoom",function(){g.attr("transform","translate("+d3.event.translate.join(",")+")scale("+d3.event.scale+")"),g.selectAll("path").attr("d",path.projection(projection))});svg.call(zooming).on("dblclick.zoom",null);